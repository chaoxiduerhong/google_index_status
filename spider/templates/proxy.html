<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <script src="/jquery.min.js"></script>
    <link rel="stylesheet" href="/style.css">
    <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
    <title>浏览器管理|列表</title>
    <style>
        .total-label{
            width: 300px;
            display: inline-block;
            background: #efefef;
            line-height: 20p;
            padding: 2px 10px;
            text-align: right;
        }
        .total-bar{
            display: inline-block;
            background: #9f8ee2;
            height: 10px;
            min-width:1px
        }
    </style>
</head>
<body>
  <div class="container">
      <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item active">浏览器管理</li>
          </ol>
      </nav>
      <div>
          {% if mode == "proxy" %}
            <strong>代理管理</strong>
            <a href="/proxy_unlimited">无限制代理管理</a>
          {% else %}
            <strong>无限制代理管理</strong>
            <a href="/proxy">代理管理</a>
          {% endif %}
        <a href="/browser">浏览器管理</a>
      </div>
      <br>
      <div class="">
          <button type="button" class="btn btn-primary" onclick="reload_page()">刷新</button>
          <button class="btn btn-primary" onclick="sync_other_host()">更新且排除其他机器运行的代理</button>
          <button class="btn btn-primary" onclick="start_browser_selected_proxy()">强制启动浏览器所选的代理</button>
          <button class="btn btn-primary" onclick="remove_not_use_proxy()">关闭未使用运行的代理</button>
          <button class="btn btn-primary" onclick="close_all_proxy()">关闭所有代理</button>
          <button class="btn btn-primary" onclick="start_all_proxy()">启动所有代理</button>
      </div>
      <br>
      <div class="" style="height:0;    display: none;">
          {% if shadowsocksr_status == "running" %}
            <button type="button" class="btn btn-info" onclick="alert('请通过客户端启动')" disabled>启动ShadowsocksR</button>
          {% else %}
            <button type="button" class="btn btn-info" onclick="alert('请通过客户端启动')">启动ShadowsocksR</button>
          {% endif %}
          &nbsp;&nbsp;ShadowsocksR 状态:&nbsp; {{shadowsocksr_status}}
      </div>
      <div class="">
           <button type="button" class="btn btn-info" onclick="start_selected_proxy()">启动所选的代理</button>
      </div>
      <br>
      <table class="table">
          <thead>
            <tr>
                <th><input type="checkbox"></th>
                <th>name</th>
                <th>title</th>
                <th>port</th>
                <th>pid</th>
                <th>process status</th>
                <th>is_use</th>
                <th>action</th>
            </tr>
          </thead>
          <tbody>
            {% for row in lists %}
                <tr style="{%if lists[row].process_info == 'running'%} background: #dfffdf; {% endif %}">
                    <td><input type="checkbox" class="selected_proxy" value="{{lists[row].name}}"></td>
                    <td>{{lists[row].source_type}}</td>
                    <td>{{lists[row].remarks}}</td>
                    <td>{{lists[row].proxy_http_port}}</td>
                    <td>{{lists[row].pid}}</td>
                    <td>{{lists[row].process_info }}</td>
                    <td>{{lists[row].is_use}}</td>
                    <td>
                        {% if lists[row].source_type == "ssr_ace" %}
                        <button class="btn btn-primary btn-sm" onclick="open_proxy('{{lists[row].name}}')" disabled>打开</button>
                        <button class="btn btn-warning btn-sm" onclick="close_proxy('{{lists[row].name}}')" disabled>关闭</button>
                        {% else %}
                        <button class="btn btn-primary btn-sm" onclick="open_proxy('{{lists[row].name}}')">打开</button>
                        <button class="btn btn-warning btn-sm" onclick="close_proxy('{{lists[row].name}}')">关闭</button>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
          </tbody>
        </table>
  </div>
  <script>
    function start_selected_proxy() {
        var checkedValues = [];
        var checkboxes = document.querySelectorAll('.selected_proxy');

        checkboxes.forEach(function(checkbox) {
            if (checkbox.checked && checkbox.value) {
                checkedValues.push(checkbox.value);
            }
        });
        let confirmed = window.confirm('你确定要打开所选的所有的代理服务器吗？')
        if (confirmed) {
            // 执行打开操作
            $.ajax({
                url: '/start_select_proxy',
                type: 'GET', // 请求类型为GET
                contentType: 'application/json',
                data: {names: checkedValues},
                success: function(response) {
                    // 请求成功时的回调函数
                    if (response.code === 200){
                        alert("请求成功")
                    } else {
                        alert("请求失败")
                    }
                    reload_page()
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // 请求失败时的回调函数
                    console.log('请求失败:', textStatus, errorThrown);
                }
            });
        }


    }
    function open_proxy(name) {
        let confirmed = window.confirm('你确定要打开这个代理服务器吗？')
        if (confirmed) {
            // 执行打开操作
            $.ajax({
                url: '/start_proxy',
                type: 'GET', // 请求类型为GET
                dataType: 'json', // 期望的返回数据类型
                data: {
                    name: name
                },
                success: function(response) {
                    // 请求成功时的回调函数
                    if (response.code === 200){
                        alert("请求成功")
                    } else {
                        alert("请求失败")
                    }
                    reload_page()
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // 请求失败时的回调函数
                    console.log('请求失败:', textStatus, errorThrown);
                }
            });
        }
    }

    function close_proxy(name) {
        let confirmed = window.confirm('你确定要关闭这个浏览器吗？')
        if (confirmed) {
            // 执行操作
            $.ajax({
                url: '/close_proxy',
                type: 'GET', // 请求类型为GET
                dataType: 'json', // 期望的返回数据类型
                data: {
                    name: name
                },
                success: function(response) {
                    // 请求成功时的回调函数
                    if (response.code === 200){
                        // alert("请求成功")
                        to_msg_queue("请求成功")
                    } else {
                        alert("请求失败")
                    }
                    // reload_page()
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // 请求失败时的回调函数
                    console.log('请求失败:', textStatus, errorThrown);
                }
            });
        }
    }


    function sync_other_host() {
        let confirmed = window.confirm('确定要更新并且排除其他电脑正在运行的代理吗？')
        if (confirmed) {
            // 执行操作
            $.ajax({
                url: '/sync_other_host',
                type: 'GET', // 请求类型为GET
                dataType: 'json', // 期望的返回数据类型
                success: function(response) {
                    // 请求成功时的回调函数
                    if (response.code === 200){
                        alert("请求成功")
                    } else {
                        alert("请求失败")
                    }
                    reload_page()
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // 请求失败时的回调函数
                    console.log('请求失败:', textStatus, errorThrown);
                }
            });
        }
    }

    function start_browser_selected_proxy() {
        let confirmed = window.confirm('确定要强制重启已选择的所有代理吗？')
        if (confirmed) {
            // 执行操作
            $.ajax({
                url: '/start_browser_selected_proxy',
                type: 'GET', // 请求类型为GET
                dataType: 'json', // 期望的返回数据类型
                success: function(response) {
                    // 请求成功时的回调函数
                    if (response.code === 200){
                        alert("请求成功")
                    } else {
                        alert("请求失败")
                    }
                    reload_page()
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // 请求失败时的回调函数
                    console.log('请求失败:', textStatus, errorThrown);
                }
            });
        }
    }

    function remove_not_use_proxy() {
        let confirmed = window.confirm('确定要关闭正在运行未使用的代理吗？')
        if (confirmed) {
            // 执行操作
            $.ajax({
                url: '/remove_not_use_proxy',
                type: 'GET', // 请求类型为GET
                dataType: 'json', // 期望的返回数据类型
                success: function(response) {
                    // 请求成功时的回调函数
                    if (response.code === 200){
                        alert("请求成功")
                    } else {
                        alert("请求失败")
                    }
                    reload_page()
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // 请求失败时的回调函数
                    console.log('请求失败:', textStatus, errorThrown);
                }
            });
        }
    }


    function close_all_proxy() {
        let confirmed = window.confirm('确定要关闭正所有代理吗？')
        if (confirmed) {
            // 执行操作
            $.ajax({
                url: '/close_all_proxy',
                type: 'GET', // 请求类型为GET
                dataType: 'json', // 期望的返回数据类型
                success: function(response) {
                    // 请求成功时的回调函数
                    if (response.code === 200){
                        alert("请求成功")
                    } else {
                        alert("请求失败")
                    }
                    reload_page()
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // 请求失败时的回调函数
                    console.log('请求失败:', textStatus, errorThrown);
                }
            });
        }
    }

    function start_all_proxy() {
        let confirmed = window.confirm('确定要启动所有代理吗？')
        if (confirmed) {
            // 执行操作
            $.ajax({
                url: '/start_all_proxy',
                type: 'GET', // 请求类型为GET
                dataType: 'json', // 期望的返回数据类型
                success: function(response) {
                    // 请求成功时的回调函数
                    if (response.code === 200){
                        alert("请求成功")
                    } else {
                        alert("请求失败")
                    }
                    reload_page()
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // 请求失败时的回调函数
                    console.log('请求失败:', textStatus, errorThrown);
                }
            });
        }
    }


    function reload_page() {
        location.reload();
    }
    function to_msg_queue(msg) {
        localStorage.setItem('show_msg_queue', msg);
    }

  </script>
</body>
</html>